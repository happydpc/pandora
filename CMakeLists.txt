cmake_minimum_required(VERSION 3.8)
project(pandora)

option(BUILD_TESTS "Build tests for Pandora" OFF)
option(BUILD_ATLAS "Build Atlas (real-time viewer)" ON)
option(TBB_FROM_SOURCE "Build Intel Threaded Building Blocks from source. Requires user to pass TBB_ROOT" OFF)

#find_package(GSL REQUIRED)# Guideline Support Library (like the Microsoft implementation)
find_package(glm REQUIRED)

find_package(assimp REQUIRED)
add_library(assimp INTERFACE)
target_include_directories(assimp INTERFACE "${ASSIMP_INCLUDE_DIRS}")
target_link_libraries(assimp INTERFACE "${ASSIMP_LIBRARIES}")
message("Assimp include dirs: ${ASSIMP_INCLUDE_DIRS}")
message("Assimp libraries: ${ASSIMP_LIBRARIES}")

find_package(embree REQUIRED)
if (NOT EMBREE_VERSION_MAJOR STREQUAL "3")
	message(FATAL_ERROR "Only Embree 3.x is supported")
endif()
add_library(embree INTERFACE)
target_include_directories(embree INTERFACE "${EMBREE_INCLUDE_DIRS}")
target_link_libraries(embree INTERFACE "${EMBREE_LIBRARY}")

if (TBB_FROM_SOURCE)
	include(${TBB_ROOT}/cmake/TBBBuild.cmake)
	tbb_build(TBB_ROOT ${TBB_ROOT} CONFIG_DIR TBB_DIR MAKE_ARGS)
	message("tbb components: ${TBB_IMPORTED_TARGETS}")
	find_package(TBB REQUIRED tbb)
else()
	find_package(tbb REQUIRED)
endif()

if (BUILD_TESTS)
    find_package(GTest REQUIRED)
endif ()

if (BUILD_ATLAS)
    find_package(glfw3 REQUIRED)
    find_package(GLEW REQUIRED)
    find_package(OpenGL REQUIRED)
endif()

include("projects/pandora/CMakeLists.txt")
if (BUILD_ATLAS)
    include("projects/atlas/CMakeLists.txt")
endif()
#include("torque/CMakeLists.txt")
